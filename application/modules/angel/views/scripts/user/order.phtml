
<div class="content wbg-wrapper">

    <div class="container_24" id="order-block">
        <div class="grid_24">

            <div class="user-page-lnk btn-group">
                <a href="<?php echo $this->url(array(), 'user-address') ?>" class="btn">Update Address</a>
                <a href="<?php echo $this->url(array(), 'user-order') ?>" class="btn selected">Orders</a>
                <a href="<?php echo $this->url(array(), 'reset-password') ?>" class="btn">Reset Password</a>
            </div>
            <?php if (count($this->orders)): ?>
                <ul class="clearfix" id="order-header">
                    <li class="oid">Order #<span class="splr"></span></li>
                    <li class="address">Address<span class="splr"></span></li>
                    <li class="order-detail">Order Detail<span class="splr"></span></li>
                    <li class="status">Status</li>
                </ul>
                <div id="order-container">
                    <?php foreach ($this->orders as $order): ?>
                        <div mid="<?php echo $order->id ?>" oid="<?php echo $order->oid ?>" ts="<?php echo $order->created_at->getTimestamp(); ?>" class="order-itm clearfix">

                            <ul>
                                <li class="oid">
                                    <i class="light-gray">#</i> <?php echo $order->oid ?>
                                    <br/>
                                    <p class="x-c-time"><strong><?php echo $order->created_at->format('jS M y') ?></strong></p>
                                </li>
                                <li class="address">
                                    <div class="pad">
                                        <?php if ($order->selected_address_type == 2): ?>
                                            <div class="x-paypal-addr">Paypal Address</div>
                                        <?php endif; ?>
                                        <p class="clearfix"><span class="l1">contact</span><span class="l2"><?php echo $order->address->contact ? $order->address->contact : '-- --' ?></span></p>
                                        <p class="clearfix"><span class="l1">phone</span><span class="l2"><?php echo $order->address->phone ? $order->address->phone : '-- --' ?></span></p>
                                        <p class="clearfix"><span class="l1">street</span><span class="l2"><?php echo $order->address->street ? $order->address->street : '-- --' ?></span></p>
                                        <p class="clearfix"><span class="l1">city</span><span class="l2"><?php echo $order->address->city ? $order->address->city : '-- --' ?></span></p>
                                        <p class="clearfix"><span class="l1">state / county</span><span class="l2"><?php echo $order->address->state ? $order->address->state : '-- --' ?></span></p>
                                        <p class="clearfix"><span class="l1">zip / postal code</span><span class="l2"><?php echo $order->address->zip ? $order->address->zip : '-- --' ?></span></p>
                                        <p class="clearfix"><span class="l1">country</span><span class="l2"><?php echo $order->address->country ? $order->address->country : '-- --' ?></span></p>
                                    </div>

                                </li>
                                <li class="order-detail">
                                    <div class="pad">
                                        <?php if ($order->order_detail): ?>
                                            <?php $count = 1; ?>
                                            <?php foreach ($order->order_detail as $order_detail): ?>
                                                <ol>
                                                    <li>
                                                        <a target="_blank" href="<?php echo $this->url(array(id => $order_detail->product_id), 'product-view') ?>">
                                                            <?php echo $count . '. ' . $order_detail->product_title ?>
                                                        </a>
                                                        <div class="x-price">
                                                            <p>price &nbsp;&nbsp; <?php echo $this->currency_symbol_options[$order->currency] . $order_detail->price . $order->currency ?> &nbsp;&nbsp; / &nbsp;&nbsp; qty &nbsp;&nbsp; <?php echo $order_detail->unit . 'pcs' ?></p>
                                                            <p></p>

                                                        </div>
                                                    </li>
                                                </ol>
                                                <?php $count++; ?>
                                            <?php endforeach; ?>
                                            <p class="x-total">
                                                TOTAL IS : <?php echo $this->currency_symbol_options[$order->currency] . $order->total . $order->currency ?>
                                            </p>
                                        <?php endif; ?>
                                    </div>
                                </li>
                                <li class="status">
                                    <div class="pad">
                                        <?php
                                        $statusCls = "";
                                        $iconCls = "";
                                        if ($order->status == 1) {
                                            $statusCls = "light-gray";
                                            $iconCls = "glyphicons alarm";
                                        } else if ($order->status == 2) {
                                            $statusCls = "purple";
                                            $iconCls = "glyphicons roundabout";
                                        } else if ($order->status == 3) {
                                            $statusCls = "green";
                                            $iconCls = "glyphicons cargo";
                                        } else if ($order->status == 4) {
                                            $statusCls = "cyan";
                                            $iconCls = "glyphicons airplane";
                                        } else if ($order->status == 5) {
                                            $statusCls = "red";
                                            $iconCls = "glyphicons gift";
                                        } else if ($order->status == 6) {
                                            $statusCls = "orange";
                                            $iconCls = "glyphicons thumbs_up";
                                        }
                                        ?>
                                        <div class="<?php echo $statusCls ?>">
                                            <i class="<?php echo $iconCls ?>"></i>
                                            <p class="x-status" ><?php echo $this->order_status_options[$order->status] ?></p>
                                        </div>
                                        <?php if ($order->status == 1): ?>
                                            <a href="javascript:void(0)" class="btn btn-warning btn-sm pay-now-btn">pay now</a>
                                            <a href="javascript:void(0)" class="btn btn-gray btn-sm remove-btn">remove</a>
                                        <?php elseif ($order->status == 2): ?>
                                            <p class="purple status-tip-2">
                                                Thanks for checking out the order we are waiting for money clearance.
                                            </p>
                                        <?php elseif ($order->status == 3): ?>
                                            <p class="green status-tip-3">
                                                Thanks we got payment and item is dispatching for you.
                                            </p>
                                        <?php elseif ($order->status == 4): ?>
                                            <p class="cyan status-tip-4">
                                                <?php
                                                if ($order->shipped_at) {
                                                    $t = $order->shipped_at->format('jS M Y');
                                                    $r1 = date_add($order->shipped_at, date_interval_create_from_date_string('10 days'))->format('jS M');
                                                    $r2 = date_add($order->shipped_at, date_interval_create_from_date_string('15 days'))->format('jS M');
                                                }
                                                ?>
                                                Shipped on <strong><?php echo $t ?></strong>. Expected arrival date is between <strong><?php echo $r1 ?></strong> to <strong><?php echo $r2 ?></strong>
                                            </p>
                                            <a href="javascript:void(0)" class="btn btn-sm btn-primary">received Item</a>
                                        <?php elseif ($order->status == 5): ?>
                                            <a href="javascript:void(0)" class="btn btn-sm btn-danger">leave review</a>
                                        <?php endif; ?>

                                    </div>
                                </li>
                            </ul>
                        </div>
                    <?php endforeach; ?>
                </div>
            <?php else : ?>
                <div class="grid_24 empty-content-block">
                    <p>Sorry haven't ordered anything yet.</p>
                    <a href="/" class="btn">Continue shopping</a>
                </div>
            <?php endif; ?>
        </div>
    </div>



</div>
<form method="post" action="<?php echo $this->url(array(), 'paypal-pay') ?>">
    <input type="hidden" name="oid" id="oid" />
</form>
<script type="text/javascript">

    (function($) {
        $('.remove-btn').click(function() {
            var container = $(this).parents('.order-itm');
            var mid = container.attr('mid');
            var options = {
                msg: 'Are you sure to remove order?',
                confirmCallback: function() {
                    var url = "<?php echo $this->url(array(), 'order-remove') ?>";
                    var data = {id: mid};
                    $.ajax({
                        url: url,
                        method: 'post',
                        dataType: 'json',
                        data: data,
                        success: function(response) {
                            if (response.code === 200) {
                                container.slideUp(200);
                            } else {
                                $.alertbox({msg: 'Failed : ' + response.error});
                            }
                        }
                    });
                }
            };
            $.confirm(options);
        });

        $('.pay-now-btn').click(function() {
            var $this = $(this);
            var oid = $this.parents('.order-itm').attr('oid');
            $('#oid').val(oid);
            $.waiting({color: 'gray', msg: 'Processing Order ...'});
            setTimeout(function() {
                $('form').submit();
            }, 1000);
        });
    })(jQuery);

</script>

<style>
    .order-itm {
        border-bottom:1px solid #DDD;
        padding:15px 0;
    }
    .order-itm:hover {
        border-color:#bbb;
    }
    .order-itm ul {
        display:block;
    }
    .order-itm ul li {
        display: block;
        line-height:24px;
        float:left;
    }
    .order-itm ul li .pad {
        padding:0 15px;
    }
    .order-itm ul li.oid, #order-header .oid {
        width:130px;
    }
    .order-itm ul li.oid {
        text-align:center;
    }
    .order-itm ul li.address, #order-header .address {
        width:300px;
    }
    .order-itm ul li.order-detail, #order-header .order-detail {
        width:320px;
    }
    .order-itm ul li.status, #order-header .status {
        text-align:center;
        width:200px;
    }
    .order-itm ul li .l1, .order-itm ul li .l2 {
        display:inline-block;
        float:left;
        width:140px;
    }
    .order-itm ul li .l1 {
        color:#999;
    }
    .order-itm ul li .l2 {
        width:130px;
    }
    ol > li {
        min-height:34px;
        position:relative;
    }
    #order-header li {
        /*        border-top:1px solid #aaa;
                border-bottom:1px solid #aaa;*/
        background:#F8F8F8;
        display:inline-block;
        float:left;
        padding:10px 0;
        position:relative;
        text-align:center;
    }
    #order-header li .splr {
        height:100%;
        position:absolute;
        right:0;
        width:1px;
        top:0;
        display:block;
        background:#FFF;
    }
    .order-detail ol {
    }
    .order-detail ol li {
        display:block;
        float:none;
    }
    .x-price {
        color:#999;
        font-size:smaller;
    }
    .x-status {
        margin-bottom:10px;
    }
    .x-c-time {
        color:#999;
        font-size:smaller;
    }
    .x-paypal-addr {
        background-color:#F8F8F8;
        color:#999;
        font-size:smaller;
        margin-bottom:15px;
        text-align:center;
    }
    .x-total {
        border-top:1px dotted #bbb;
        color:#ef3546;
        margin-top:10px;
        padding-top:10px;
        text-align:center;
    }
    .status-tip-2 {
        background:#FDE5DD;
        font-size:smaller;
        line-height:18px;
        padding:5px;
    }
    .status-tip-3 {
        background:#ebf7e7;
        font-size:smaller;
        line-height:18px;
        padding:5px;
    }
    .status-tip-4 {
        background:#e9f4fa;
        font-size:smaller;
        line-height:18px;
        margin-bottom:15px;
        padding:5px;
    }
    /*    #order-header li:nth-child(even)
        {
            background:#FBFBFB;
        }*/
</style>