

<div class="content wbg-wrapper">
    <div class="container_24">
        <div class="grid_10">
            <h1 class="nomargin"><?php echo $this->title ?></h1><span class="subtt-checkout">fast shipping service for you</span>
        </div>
        <div class="grid_14">
            <div id="pay-proc">
                <div class="red" id="step1">
                    <i class="glyphicons shopping_cart"></i>
                    Shopping Cart
                </div>

                <div class="light-gray" id="step2">
                    <i class="halflings barcode"></i>
                    Address &amp; Shipping
                </div>

                <div class="light-gray" id="step3">
                    <i class="halflings saved"></i>
                    Payment Complete
                </div>

                <div id="proc">
                    <div id="inner" style="width:10%"></div>
                </div>
            </div>
        </div>
        <div class="grid_24" id="cart-list">
            <table>
                <thead>
                    <tr>
                        <th class="col1 cart-photo"></th>
                        <th class="col2 cart-title">Product</th>
                        <th class="col3 cart-price">Price</th>
                        <th class="col4 cart-qty">Qty</th>
                        <th class="col5 cart-subtotal">Subtotal</th>
                        <th class="col6 cart-operation"></th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>
        <div class="grid_24" id="cart-empty">
            <p>Sorry your shopping cart is empty.</p>
            <a href="/" class="btn">Continue shopping</a>
        </div>
    </div>
    <div class="container_24" id="pay-info">
        <div class="grid_14">
            &nbsp;
        </div>
        <div class="grid_5">
            <p class="right-float">total is</p>
        </div>
        <div class="grid_5">
            <p id="total" class="right-float"></p>
            <button id="checkout-btn" class="checkout-btn green-btn right-float"><i class="halflings barcode"></i> Confirm &amp; Next</button>
        </div>
    </div>

    <div class="container_24 checkout" id="address-block">
        <div class="grid_10">
            <h1 class="nomargin">Address &amp; Shipping</h1><span class="subtt-checkout">please input correct address</span>

        </div>
        <div class="grid_14">
            <div id="pay-proc">
                <div class="red" id="step1">
                    <i class="glyphicons shopping_cart"></i>
                    Shopping Cart
                </div>

                <div class="red" id="step2">
                    <i class="halflings barcode"></i>
                    Address &amp; Shipping
                </div>

                <div class="light-gray" id="step3">
                    <i class="halflings saved"></i>
                    Payment Complete
                </div>

                <div id="proc">
                    <div id="inner" style="width:50%"></div>
                </div>
            </div>
        </div>
        <div class="grid_24">

            <div class="btn-group address-type">
                <a href="javascript:void(0)" class="btn selected"><i class='halflings uni-paperclip'></i> Write address now</a>
                <a href="javascript:void(0)" class="btn"><i class='halflings cloud_download'></i> Login &amp; Load my address</a>
                <a href="javascript:void(0)" class="btn"><i class='font-paypal'></i> Use my paypal address</a>
            </div>

            <div>
                <div class="ftb nlm">
                    <p class="ftbp">
                        <i class="halflings user"></i>
                        <input type='text' class='nothing-txt' id="contact" title="CONTACT" placeholder="CONTACT"/>

                    </p>
                    <span class="top-c"></span>
                </div>
                <div class="ftb">
                    <p class="ftbp">
                        <i class="halflings phone_alt"></i>
                        <input type='text' class='nothing-txt' id="phone-number" title="PHONE NUMBER" placeholder="PHONE NUMBER"/>
                    </p>
                    <span class="top-c"></span>
                </div>
                <div class="clear"></div>
                <div class="ftb full nlm">
                    <p class="ftbp">
                        <i class="halflings home"></i>
                        <input type='text' class='nothing-txt' id="street-address" title="STREET ADDRESS" placeholder="STREET ADDRESS"/>
                    </p>
                    <span class="top-c"></span>
                </div>
                <div class="clear"></div>
                <div class="ftb nlm">
                    <p class="ftbp">
                        <i class="halflings tag"></i>
                        <input type='text' class='nothing-txt' id="city" title="CITY" placeholder="CITY"/>
                    </p>
                    <span class="top-c"></span>
                </div>
                <div class="ftb">
                    <p class="ftbp">
                        <i class="halflings tags"></i>
                        <input type='text' class='nothing-txt' id="state" title="STATE / COUNTY" placeholder="STATE / COUNTY"/>
                    </p>
                    <span class="top-c"></span>
                </div>
                <div class="clear"></div>
                <div class="ftb nlm">
                    <p class="ftbp">
                        <i class="halflings envelope"></i>
                        <input type='text' class='nothing-txt' id="zip" title="ZIP / POSTAL CODE" placeholder="ZIP / POSTAL CODE"/>
                    </p>
                    <span class="top-c"></span>
                </div>
                <div class="ftb">
                    <p class="ftbp">
                        <i class="halflings globe"></i>
                        <select title="COUNTRY" id="country">
                            <option>CHOOSE COUNTRY</option>
                            <option>United Kingdom</option>
                            <option>United States</option>
                            <option>Japan</option>
                            <option>Hong Kong</option>
                            <option>Germany</option>
                        </select>
                    </p>
                </div>
            </div>
            <div class="clear-20"></div>
            <div class="text-center">
                <button type="submit" class="pp-btn"></button>
            </div>
            <div class="clear-50"></div>
        </div>
    </div>

</div>
<div class="P_tmp">
    <table>
        <tr class="cart-list-itm">
            <td class="col1 cart-photo"></td>
            <td class="col2 cart-title"></td>
            <td class="col3 cart-price"></td>
            <td class="col4 cart-qty"></td>
            <td class="col5 cart-subtotal"></td>
            <td class="col6 cart-operation"><button class="cart-remove-btn">&times;</button></td>
        </tr>
    </table>
    <div class="price" price="0" currency="">
        <span class="price-str">0</span>
    </div>
</div>

<script type="text/javascript">
    function requestCart() {
        var query = $.cart.parse();
        if (!query) {
            // empty handle
            return;
        }
        var data = new Array();
        $.each(query, function(k, v) {
            data.push(k);
        });
        var s = data.join('|');
        data = {query: s};

        $.ajax({
            url: '<?php echo $this->url(array(), 'cart') ?>',
            dataType: 'json',
            type: 'post',
            data: data,
            success: function(response) {
                var container = $('#cart-list table tbody');
                container.empty();
                if (response.code === 200) {
                    $.each(response.data, function() {
                        var $this = this;
                        var row = $('.P_tmp .cart-list-itm').clone(true);
                        row.attr('id', $this.id);
                        var selling_price = $this.selling_price;
                        var qty = query[$this.id];
                        $.each(selling_price, function(k, v) {
                            // set price
                            var price = $('.P_tmp .price').clone(true);
                            price.attr('price', v.amount);
                            price.attr('symbol', v.symbol);
                            price.find('.price-str').html(v.symbol + v.amount + k);
                            price.attr('currency', k);
                            row.find('.cart-price').append(price);
                            // set subtotal
                            var subtotal = $('.P_tmp .price').clone(true);
                            var a = (qty * v.amount).toFixed(2);
                            subtotal.attr('price', a);
                            subtotal.attr('symbol', v.symbol);
                            subtotal.find('.price-str').html(v.symbol + a + k);
                            subtotal.attr('currency', k);
                            row.find('.cart-subtotal').append(subtotal);
                        });
                        // set photo
                        row.find('.cart-photo').append($('<img>').attr('src', $this['photo']));
                        // set qty
                        var input = $('<input>').attr('type', 'text').attr('maxlength', 2).val(qty);
                        input.integerInput();
                        input.change(function() {
                            var qty = $(this).val();
                            var id = $(this).closest('tr').attr('id');
                            $.cart.set(id, parseInt(qty));
                            requestCart();
                        });
                        row.find('.cart-qty').append(input);
                        row.find('.cart-title').append($('<a>').attr('target', '_blank').attr('href', $this.link).html($this.title));
                        container.append(row);
                    });
                    // set pay-info
                    var tmps = {};
                    $.each($('#cart-list .cart-list-itm'), function() {
                        var $this = $(this);
                        var p = $this.find('.cart-subtotal .price');
                        $.each($(p), function() {
                            var $this = $(this);
                            if (tmps[$this.attr('currency')]) {
                                tmps[$this.attr('currency')].amount = (parseFloat(tmps[$this.attr('currency')].amount) + parseFloat($this.attr('price'))).toFixed(2);
                            } else {
                                tmps[$this.attr('currency')] = {amount: parseFloat($this.attr('price')), symbol: $this.attr('symbol')};
                            }
                        });
                    });
                    $('#pay-info #total').empty();
                    $.each(tmps, function(k, v) {
                        var row = $('.P_tmp .price').clone(true);
                        row.attr('price', v.amount);
                        row.attr('currency', k);
                        row.find('.price-str').html(v.symbol + v.amount + k);
                        $('#pay-info #total').append(row);
                    });
                    $('#pay-info').fadeIn(100);
                } else if (response.code === 404) {
                    $('#cart-list').hide();
                    $('#pay-info').hide();
                    $('#cart-empty').show();
                }
                $('#cart-total').html($.cart.total());
            },
            complete: function() {
                $.currency.refresh();
            }
        });
    }

    (function($) {
        requestCart();
        $('.cart-remove-btn').click(function() {
            var tr = $(this).closest('tr');
            $.cart.set(tr.attr('id'), 0);
            requestCart();
        });
        $('#checkout-btn').click(function() {
            if ($.cart.total()) {
                $('#address-block').show();
                $('html, body').animate({scrollTop: $('#pay-info').offset().top}, 300);
                $('#contact').focus();
            } else {
                var html = "<p class='marginbottom5px'>Sorry the cart is empty now.</p><button class='sm-btn black-btn'>Refresh Page</button>";
                $.alertbox({msg: html});
            }
        });
        $('.ftb').click(function() {
            var $this = $(this).closest('.ftb');
            var txt = $this.find('.nothing-txt');
            if (txt.length) {
                txt.focus();
            }

        });

        $('.ftb .nothing-txt').keyup(function() {
            switchTopC();
        });
    })(jQuery);


    function switchTopC() {
        var DURA = 200;
        $.each($('.ftb'), function() {
            var $this = $(this).closest('.ftb');
            var top_c = $this.find('.top-c');
            var input = $this.find('.nothing-txt');
            if (top_c.length && input.length) {
                top_c.html(input.attr('placeholder'));
                if (input.val()) {
                    top_c.fadeIn(DURA);
                } else {
                    top_c.fadeOut(DURA);
                }
            }
        });

    }
</script>

<style>
    #cart-list table {
        width:100%;
    }
    #cart-list table th {
        background:#F0F0F0;
        color:#aaa;
        padding:5px 0;
        text-align:center;
    }
    #cart-list table td {
        border-bottom:1px solid #eee;
        padding:15px 0;
        text-align:center;
        width: 15%;
    }
    #cart-list table .col2 {
        width:20%;
    }

    #cart-list table .col6 {
        text-align:right;
    }
    #cart-list .cart-list-itm {
        padding:20px;
    }
    #cart-list .cart-list-itm input[type=text] {
        height:24px;
        line-height:24px;
        padding:0 5px;
        text-align:center;
        width:30px;
    }
    #cart-empty {
        border-bottom:1px solid #DDD;
        border-top:1px solid #DDD;
        display:none;
        margin-bottom:50px;
        padding-bottom:50px;
        padding-top:50px;
        text-align:center;
    }
    #cart-empty p {
        font-size:16px;
        padding-bottom:20px;
    }
    #cart-empty a {

    }

    #pay-info {
        display:none;
        font-size:15px;
        padding:20px 0;
    }
    #pay-info .grid_4 {
        text-align:right;
    }
    #pay-info #total * {
        color:#EF3546;
    }
    #checkout-btn {
        margin-top:20px;
    }
    .cart-remove-btn {
        background:transparent;
        color:#999;
        font-size:16px;
        height:20px;
        margin:0 10px 0 0;
        padding:0;
        width:20px;
    }
    .cart-remove-btn:hover {
        background:transparent;
        box-shadow:none;
        color:#333;
    }

    #address-block {
        display:none;
    }
    .address-type.btn-group {
        margin-bottom:30px;
    }
    .nlm {
        border-left:none !important;
    }

    .ftb {
        border-bottom:1px solid #DDD;
        border-left:1px solid #DDD;
        box-sizing:border-box;
        float:left;
        padding:22px 10px 8px 10px;
        width: 50%;
    }
    .ftb:hover {
        cursor:text;
    }
    .ftb:hover i, .ftb:hover input {
        color:#EF3546;
    }
    .ftb.full {
        width: 100%;
    }
    .ftb.full .nothing-txt {
        width:540px !important;
    }
    .ftbp {
        padding-left:12px;
    }
    .ftbp select {
        background:#FFF;
        height:30px;
        margin:0;
        padding:0 8px;
    }
    .ftbp i {
        margin-right: 8px;
    }


    .ftb .top-c {
        color:#CCC;
        display: none;
        font-size:9px;
        left:46px;
        position: absolute;
        top:10px;
    }
</style>